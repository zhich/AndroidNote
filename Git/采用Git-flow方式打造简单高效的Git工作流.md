## 目录

- [为什么选择Git](#为什么选择git)
- [GitFlow分支介绍](#gitflow分支介绍)
- [常见的场景和操作规范](#常见的场景和操作规范)
  - [开发新功能](#开发新功能)
  - [上线](#上线)
  - [紧急修复](#紧急修复)
  - [一些注意事项](#一些注意事项)




### 为什么选择Git

- 节省时间
- 离线工作
- 撤销错误操作
- 可靠性高
- 让提交更有意义
- 更高的自由度
- 避免混乱
- 顺应潮流

### GitFlow分支介绍

- master

  【线上的分支】 - 是线上版本分支，也可以理解为随时可以发布的稳定版本，要求在每次版本封版后由主程序员合并 `release` 分支代码进来，开发人员不可以随意操作。

- develop

  【开发基础分支】 - 包含待上线的新内容，是你进行任何新的开发的基础分支。当你开始一个新的功能分支时，它将是**开发的基础**，由此拉出 `feature` 分支准备新功能开发。另外，该分支也汇集所有已经完成的功能，并等待经过 `release` 分支测试通过后最终被整合到 `master` 分支中。

- release

  【上线分支】 - 当开发结束后用来提测并且为本次版本最终上线的分支，所有测试阶段的 bug 全部在此分支修复，测试结束后合并到 `master` 和 `develop` 分支中。

  当准备将 develop 上的新内容发布到生产环境时，需要拉 release 分支。release 分支可以隔离 develop 后续对本次上线的影响。当 release 拉出来后，不用担心其它的东西会合过来，只需要在这上面专注测试和修复 bug。

- feature

  【新功能开发分支】 - 开发新功能时以 develop 分支为基础建立新的 feature 分支进行单独开发。当需要此功能的时候，只需要将该  `feature` 分支合并入 `develop` 分支，下次一并提测即可。

  这样设计可以避免这个功能在尚未开发完成或者通过测试的时候混入发布的版本，而导致不可预知的不稳定。当然也可以同时开启多个 `feature` 分支进行不同新功能开发，在合适的时候合并提测即可。

- hotfix

  【线上紧急bug分支】 - 用来修复线上的紧急 bug，应由 `master` 拉出，并在修复完成后合并入 `master` 和 `develop` 保证两分支的 bug 已修复。


> **master** 和 **develop** 这两个分支被称作为**长期分支**，它们会存活在项目的整个生命周期中。而其他的分支，例如针对功能的分支，针对发行的分支，仅仅只是临时存在的。它们是根据需要来创建的，当它们完成了自己的任务之后就会被删除掉。

### 常见的场景和操作规范

#### 开发新功能

1. 从 `develop` 拉一个 `feature` 分支。
2. 在 `feature` 分支上做开发。
3. `feature` 开发完成后，需要提交测试，

  **有两种场景：**

  一种是该 `feature` 功能不复杂，测试点不多，自测充分后可以直接完成 `feature` ；

  另一种是 `feature` 功能非常复杂，测试点也很多。这个时候不要马上完成 `feature`，前期让 QA 直接在 `feature` 分支上测试，等测得比较稳定后再完成 `feature`。因为功能复杂的 `feature`，自测完成后肯定还是有很多问题，过早合到 `develop`，`develop` 将有很长一段时间不能上线，会影响到其它的发布。

4. 完成 `feature` 将 `feature` 分支合并到 `develop`，删除原分支。

#### 上线

- `develop` 会不断累积新内容等待上线。上线时，准备一个 `release` 分支，准备 `release` 分支时需要搞清楚这次上线新增的内容，列给 QA ，让 QA 有针对性的测试。

- 在打包机器上打包对应的 `release` 分支，部署到应用服务器让 QA 测试，发现 bug 直接在 `release` 上修改。

- `release` 测试通过后，可以上线了，则将 `release` 合到 `master` 和 `develop`，删除该 `release` 分支。

- 线上部署的时候，从 `master` 打一个包，先部署到预发，在预发上简单回归测试，没问题后发布到线上服务器，上线完成。

#### 紧急修复

- 对于一些需要马上修改并尽快上线的内容，走 `hotfix` 分支。

- 从最新的 `master` 拉 `hotfix` 分支并在 `hotfix` 分支上修改。

- 在打包机器上打包对应的 `hotfix` 分支，部署到应用服务器给 QA 测试，发现 bug 直接在 `hotfix` 分支上修改。

- `hotfix` 测试通过后，可以上线了，则将 `hotfix` 合并到 `master` 和 `develop`，删除该 `hotfix` 原分支。

#### 一些注意事项

- 每一个流程完成后一定要记得合代码和推代码，不然会坑到后面的人。

- 及时在群里同步信息。

- `release` 分支最好一天不超过一个，如果需要上线多次，可以合并到一起。

- 拉分支前记得 `pull` 新代码。


[原文](https://www.thinktxt.com/git/2017/06/16/create-git-flow-efficient-work-flow.html)